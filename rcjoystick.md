## Использование аппаратуры как джойстика для передачи каналов RC через mavlink

### Теория
Программы наземных станций, такие как Mission Planner или QGroundControl, способны распознавать подключенные джойстики либо аппаратуры в режиме usb-джойстика и
передавать на полетный контроллер значения осей в пакете RC_CHANNELS_OVERRIDE (#70). Однако, QGC передает только первые 4 канала (две оси), остальное можно назначить только на кнопки,
а MP может это делать только под Windows, что не всегда удобно. Я написал простейшее приложение для регистратора, которое распознает подключенный джойстик и отправляет пакет в mavlink-routerd.

### Запускаем
Сначала нужно предусмотреть эндпоинт mavlink-routerd, куда будем отправлять значения. Пока это сделаем вручную в /etc/mavlink.conf:
```
[UdpEndpoint rcjoystick]
Mode = Server
Address = 127.0.0.1
Port = 14549
```

Также нам необходимо ядро и rootfs с поддержкой usb-hid. Для этого [прошейте](notes_start_hi3536ev100) их из [`/hi3536dv100`](hi3536dv100) каталога.
Необходимо обеспечить запуск модуля `hid-generic.ko`, для этого добавьте `modprobe hid-generic.ko` в [`S95hisilicon`](hi3536dv100/etc/init.d/S95hisilicon).

Далее нужно из [архива с пакетом и бинарником](rcjoystick.zip) скопировать `rcjoystic` в /usr/bin через WinSCP и назначить права на исполнение: `chmod +x /usr/bin/rcjoystick`.
Перезагружаемся, подключаем аппаратуру к регистратору по usb и пробуем в консоли запустить `rcjoystick`. Если все прошло хорошо, то на экране мы должны увидеть значения осей при изменении
положения стиков и переключателей, а в программе телеметрии, например в QGC (analyse tools > Mavlink inspector > RC_CHANNELS_RAW) должны изменяться каналы.

Проект пока в стадии тестирования, поэтому [присылайте](https://t.me/+BMyMoolVOpkzNWUy) свои отзывы о попытках и пожелания.
