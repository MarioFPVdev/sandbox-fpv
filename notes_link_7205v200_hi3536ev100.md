
### Заметки по постройке видеолинка с телеметрией

Воздушная часть линка представляет из себя камеру gk7205v200 с подключенным по USB wifi-адаптером на чипе rtl8812au, например ASUS USB AC-56.
Наземная часть - это видеорегистратор на базе чипа hisilicon hi3536dv100 либо ev100, к которому точно так же подключен по USB адаптер rtl8812au или rtl8814au.

## Возможности

Данный линк способен передавать видео с воздушной части форматом (разрешение@частота кадров) 1920x1080@30 или 1200x720@50 кодеками h264 либо h265 и телеметрию mavlink в обе стороны. Общая схема процессов для передачи видео выглядит так:

![video](https://github.com/OpenIPC/sandbox-fpv/raw/master/notes_files/video.png)

Передача видео на текущий момент возможна двумя способами. Классический - streamer *majestic* через udp порт 5600 засылает RTP/h264 или RTP/h265 поток  в [wfb-ng](https://github.com/svpcom/wfb-ng) для передачи на землю, где принимается ответной частью wfb-ng и отправляется для воспроизведения на PC или планшет / смартфон по LAN или USB ethernet (tethering). Формат RTP свободно воспроизводится программами для GS, такими как [QGroundControl](https://github.com/mavlink/qgroundcontrol), [Mission Planner](https://ardupilot.org/planner/) или [FPV-VR](https://github.com/Consti10/FPV_VR_OS). Но его пока невозможно вывести в порт HDMI регистратора, поскольку он построен на специализированном чипе со своим SDK и обычными способами, например через *GStreamer* как обычно выводят видео в случае Raspberry Pi, этого не сделать. Alexey Bezborodov из команды OpenIPC предоставил на тесты скомпилированные примеры *vencoder* и *vdecoder*, вытащенные из Hisilicon SDK и в оригинальном виде расположенные [тут](https://github.com/OpenIPC/silicon_research). *VENC* запускается на камере и формирует поток h264 с фрагментацией HAL вместо *majestic*, *VDEC* на регистраторе выводит этот поток в HDMI. Все работает, но естественно нет OSD и подобный нестандартный поток невозможно воспроизвести сторонними плеерами.

Этот вопрос можно решить, "научив" *vdecoder* распознавать RTP/h26[4-5] с помощью библиотеки *libavformat/avformat.h* и по прежнему "стримить" на камере через *majestic*. Для этого нужна помощь программиста C++, если вы желаете помочь проекту с этим - [обращайтесь](https://t.me/+BMyMoolVOpkzNWUy).

Пример настройки *GStreamer* на Mission Planner для воспроизведения h265: `udpsrc port=5600 buffer-size=90000 ! application/x-rtp ! rtph265depay ! avdec_h265 ! videoconvert ! video/x-raw,format=BGRA ! appsink name=outsink
`
